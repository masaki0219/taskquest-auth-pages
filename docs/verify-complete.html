<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>メール認証が完了しました | TaskQuest</title>
    <style>
      :root {
        --bg1: #667eea;
        --bg2: #764ba2;
        --bg3: #f093fb;
      }
      body {
        margin: 0;
        min-height: 100vh;
        font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Noto Sans JP, Helvetica, Arial, sans-serif;
        color: #111827;
        background: linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3));
        display: grid;
        place-items: center;
      }
      .card {
        background: rgba(255,255,255,0.97);
        border-radius: 16px;
        padding: 28px 24px;
        max-width: 520px;
        width: calc(100% - 32px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        text-align: center;
      }
      h1 { font-size: 22px; margin: 0 0 12px; }
      p { margin: 8px 0; color: #374151; }
      .small { color: #6b7280; font-size: 12px; }
      .btn {
        display: inline-block;
        margin-top: 16px;
        padding: 12px 16px;
        background: #6366f1;
        color: #fff;
        border-radius: 10px;
        text-decoration: none;
        font-weight: 600;
      }
      .btn.secondary { background: #10b981; }
      .links { margin-top: 16px; display: grid; gap: 8px; }
      code { background: #f3f4f6; padding: 2px 6px; border-radius: 6px; }
    </style>
    <script>
      // 認証成功後に Supabase からこのページに ?code=...&type=signup などで遷移してきます。
      // 可能ならネイティブアプリへディープリンクで受け渡し、それが無理でも本ページで完了案内を表示します。
      function buildDeepLink() {
        const scheme = 'taskquestfresh://auth/callback';
        // 受け取ったクエリをそのまま引き継ぎ（code/type 等）
        const qs = window.location.search || '';
        return scheme + qs;
      }
      function tryOpenApp() {
        const deeplink = buildDeepLink();
        // すぐにアプリを開く試行
        window.location.href = deeplink;
        // 失敗時はページに留まる（Gmailアプリ内など）。
      }
      document.addEventListener('DOMContentLoaded', () => {
        // 自動で開くのは 600ms 後にして、ユーザーに見出しをまず見せる。
        setTimeout(tryOpenApp, 600);
        // Deep Linkをボタンにも設定
        const openBtn = document.getElementById('open-app');
        if (openBtn) openBtn.href = buildDeepLink();
      });
    </script>
  </head>
  <body>
    <main class="card">
      <h1>メール認証が完了しました 🎉</h1>
      <p>アカウントのメールアドレスが確認されました。</p>
      <p>アプリに戻るか、以下のボタンから開いてください。</p>
      <a id="open-app" class="btn" href="#">アプリを開く</a>
      <div class="links">
        <a class="btn secondary" href="/" onclick="history.back(); return false;">前の画面に戻る</a>
        <p class="small">ボタンで開けない場合は、アプリを起動してログインしてください。</p>
      </div>
    </main>
  </body>
  </html>

